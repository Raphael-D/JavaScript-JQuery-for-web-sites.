ACMS.Dispatch.Edit.MAP_NOTFOUND="見つかりませんでした";ACMS.Dispatch.Edit.MAP_INPUT="住所、又はスポット名を入力してください";ACMS.Dispatch.Edit.map=function(j){var a=$(".js-map_editable-container",j).add(".column-map",j);var c=$(".js-map_editable-lat",j).add(':input[name^="map_lat_"]',j);var d=$(".js-map_editable-lng",j).add(':input[name^="map_lng_"]',j);var i=$(".js-map_editable-zoom",j).add(':input[name^="map_zoom_"]',j);if(!a.size()||!a.is("img")){return false}if(!c.size()||!c.is(":input")){return false}if(!d.size()||!d.is(":input")){return false}var h=ACMS.Library.parseQuery(a.attr("src").replace(/^[^?]*\?/,""));var b=h.center.split(",");var k=parseInt(h.zoom,10);if(i.size()&&i.val().length){k=parseInt(i.val(),10)}var g=null;var f=null;var e=function(){var p=$($.parseHTML('<div style="overflow:hidden;" class="acms-admin-gmap-box JS_custom-map"></div>'));p.css("width",a.width()+"px");p.css("height",a.height()+"px");a.replaceWith(p);f=o();g=new google.maps.Map(p.get(0),{zoom:k,center:f,mapTypeId:google.maps.MapTypeId.ROADMAP,streetViewControl:false,scrollwheel:false,styles:ACMS.Config.s2dStyle});var m=new google.maps.Marker({position:f,map:g,draggable:true});function o(){return new google.maps.LatLng(c.val(),d.val())}function q(){var u=o();g.panTo(u);m.setPosition(u)}function r(v){g.panTo(v);m.setPosition(v);var w=Math.round(v.lat()*1000000);var u=Math.round(v.lng()*1000000);c.val(w/1000000);d.val(u/1000000)}c.change(q);d.change(q);google.maps.event.addListener(m,"dragend",function(u){r(u.latLng)});if(i.size()){i.change(function(){g.setZoom(parseInt($(this).val(),10))});google.maps.event.addListener(g,"zoom_changed",function(){i.val(g.getZoom())})}var n=$(".js-editable_map-search_text",j).add(':input[name="mapSearchTexts[]"]',j);var l=$(".js-editable_map-search_button",j).add(':input[name="mapSearchButtons[]"]',j);if(n.size()&&l.size()){n.val(ACMS.Dispatch.Edit.MAP_INPUT).removeAttr("disabled").addClass("default");l.removeAttr("disabled");var t=function(v){v.preventDefault();var u=n.val();if(!u){return false}n.attr("disabled","disabled");l.attr("disabled","disabled");var w=new google.maps.Geocoder;w.geocode({address:u},function(y,x){if(x==google.maps.GeocoderStatus.OK){r(y[0].geometry.location)}else{n.val(ACMS.Dispatch.Edit.MAP_NOTFOUND);n.addClass("default")}n.removeAttr("disabled");l.removeAttr("disabled")});return false};l.click(t);var s=function(){if(document.all){return function(u){return u.keyCode}}else{if(document.getElementById){return function(u){return u.keyCode?u.keyCode:u.charCode}}else{if(document.layers){return function(u){return u.which}}}}}();n.bind("keydown",function(u){if(13===s(u)){l.click();return false}});n.focus(function(){var u=$(this);if(u.is(".default")){u.val("").removeClass("default")}u.select()});n.blur(function(){var u=$(this);if(""==u.val()){u.val(ACMS.Dispatch.Edit.MAP_INPUT);u.addClass("default")}})}};if(c.val().length&&d.val().length){e()}else{a.click(function(){if(!c.val().length){c.val(b[0])}if(!d.val().length){d.val(b[1])}if(i.size()){i.val(k)}e()})}};